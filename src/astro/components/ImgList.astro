---
import { splitCommas } from "src/utils/string";
import Icon from "./Icon.astro";

type Props = {
    imgUrls: string;
    imgLabel: string;
};

const { imgUrls, imgLabel } = Astro.props;

const imgUrlList = splitCommas(imgUrls);
const imgLabelList = splitCommas(imgLabel);

function getUrl(url: string) {
    return `${import.meta.env.PUBLIC_BASE_URL ?? DEFAULT_BASE_URL}${url}`;
}

function getPosterUrl(url: string) {
    return `${import.meta.env.PUBLIC_BASE_URL ?? DEFAULT_BASE_URL}/poster${url}.png`;
}

function getImgThumbnailUrl(url: string) {
    return `${import.meta.env.PUBLIC_BASE_URL ?? DEFAULT_BASE_URL}/thumb${url}`;
}

function isVideoFile(url: string) {
    return url.endsWith(".mp4");
}
---

<div class="image-viewer">
    {
        imgUrlList.map((url, id) => {
            const videoUrl = getUrl(url);

            return (
                <a
                    class="img-button"
                    href={videoUrl}
                    target="_blank"
                    rel="noopener noreferrer"
                    title="클릭하면 새 창에서 전체 화면을 확인하실 수 있습니다."
                >
                    <figure>
                        {isVideoFile(url) ? (
                            <video
                                muted
                                playsinline
                                loop
                                poster={getPosterUrl(url)}
                            >
                                <source src={videoUrl} type="video/mp4" />
                            </video>
                        ) : (
                            <img
                                src={getImgThumbnailUrl(url)}
                                alt={imgLabelList[id]}
                            />
                        )}
                        <figcaption class="img-caption">
                            {imgLabelList[id]}
                            <Icon icon="io5-open" />
                        </figcaption>
                    </figure>
                </a>
            );
        })
    }
</div>

<style>
    .image-viewer {
        display: flex;
        flex-wrap: wrap;
        column-gap: 0.5rem;
        margin-left: -0.5rem;

        img,
        video {
            height: 100px;
            aspect-ratio: 16/8;
            margin: 0 auto 0.25rem auto;
            object-fit: cover;
            object-position: top center;
        }
    }

    .img-button {
        transition:
            transform 0.25s ease-in-out,
            background-color 0.25s ease-in-out;
        padding: 0.5rem;
        cursor: pointer;
        border-radius: 4px;

        &:hover {
            background-color: var(--colors-bg-o60);
            transform: scale(1.05);
        }

        i {
            float: right;
        }
    }

    .img-caption {
        display: flex;
        align-items: center;
        justify-content: space-between;
        column-gap: 0.25rem;
        font-weight: 300;
        font-size: 0.875rem;
    }
</style>
