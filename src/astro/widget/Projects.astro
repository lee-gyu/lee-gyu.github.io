---
import { css } from "src/styled-system/css";
import Title from "../components/Title.astro";
import { useTranslations, type ProjectKeyPrefix } from "src/i18n/utils";
import { splitWithCommas } from "src/utils/string";

type Props = {};

type ProjectTabList = {
    id: string;
    title: string;
    projects: ProjectInfo[];
};

const lang = Astro.currentLocale as Lang;
const t = useTranslations(lang);

const projectTabs: ProjectTabList[] = [
    {
        id: "innorules",
        title: t("project.tab.0"),
        projects: [],
    },
    {
        id: "samsung-vd",
        title: t("project.tab.1"),
        projects: [],
    },
    {
        id: "samsung-gtc",
        title: t("project.tab.2"),
        projects: [],
    },
    {
        id: "personal",
        title: t("project.tab.3"),
        projects: [],
    },
];

const titleCss = css({
    fontWeight: 600,
    opacity: 0.8,
    fontFeatureSettings: "'tnum'",
    letterSpacing: "-0.04em",
});

function getProjectData(key: ProjectKeyPrefix): ProjectInfo {
    return {
        header: t(`project.${key}.header`),
        role: t(`project.${key}.role`),
        goal: t(`project.${key}.goal`),
        period: t(`project.${key}.period`),
        content: t(`project.${key}.content`),
        result: t(`project.${key}.result`),
        urls: splitWithCommas(t(`project.${key}.urls`)),
    };
}
---

<div class="project-contents-wrapper">
    <ol id="tab-list-items" class="projects-tab-wrapper" role="tablist">
        {
            projectTabs.map((tab, id) => (
                <li>
                    <button
                        class:list={["tab-button", id === 0 && "is-active"]}
                        data-tab-id={tab.id}
                    >
                        {tab.title}
                    </button>
                </li>
            ))
        }
    </ol>
    <div class="tab-contents">
        {
            projectTabs.map((tab) => (
                <div class="project-tab-contents">
                    <header>{tab.title}</header>
                </div>
            ))
        }
    </div>
</div>

<script>
    document
        .getElementById("tab-list-items")
        ?.addEventListener("click", (ev) => {
            const target = ev.target as HTMLElement;
            const button = target.closest(".tab-button");

            if (!button) return;

            document
                .querySelectorAll(".tab-button.is-active")
                .forEach((btn) => btn.classList.remove("is-active"));

            button.classList.add("is-active");
        });
</script>

<style>
    .projects-tab-wrapper {
        position: sticky;
        top: 0;
        left: 0;
        margin: 0.5rem 0;
        display: flex;
        column-gap: 0.5rem;
        align-items: end;
    }

    .project-year-group {
        margin: 0.5rem 0;
    }

    .project-tab-contents {
        min-width: 100%;
        scroll-snap-align: start;
        padding: 0 1.5rem 0 2.5rem;
    }

    .tab-contents {
        width: calc(100% + 3.5rem);
        display: flex;
        overflow-x: auto;
        scroll-snap-type: x mandatory;
        margin-left: -2.5rem;
        scrollbar-width: none;
    }

    .tab-button {
        position: relative;
        transition: all 0.15s ease-in-out;
        opacity: 0.5;
        cursor: pointer;
        padding: 0 0.25rem;
        border-radius: 4px;

        &::before {
            transition: all 0.15s ease-in-out;
            content: "";
            position: absolute;
            width: 0;
            height: 2px;
            bottom: 0;
            left: 50%;
            background-color: var(--colors-text);
        }

        &:hover {
            opacity: 0.8;
        }

        &.is-active {
            opacity: 1;

            &::before {
                width: 100%;
                left: 0;
            }
        }

        &:first-child {
            margin-left: -0.25rem;
        }
    }
</style>
